(()=>{"use strict";const t=function(){let t=!1;return{changeTurn:function(){t=!1===t},isTurn:function(){return t},resetTurn:function(){t=!1}}};function e(t){return Math.floor(Math.random()*(t+1))}function n(t,e){return t.x===e.x&&t.y===e.y}const r=function(){let t=[5,4,3,3,2],r=[],o=[];function i(t,e,o,i){const s=function(t,e,n,r){const o=[];for(let i=0;i<t;i+=1)"horizontal"===r?o.push({x:e+i,y:n}):o.push({x:e,y:n+i});return o}(t,e,o,i),c=function(t){let e=!0;for(let o=0;o<r.length;o+=1){const i=r[o].coordinates;if(t.filter((t=>i.some((e=>n(t,e))))).length){e=!1;break}}return e}(s),u=s.every((t=>{const{x:e,y:n}=t;return e>=0&&e<=9&&n>=0&&n<=9}));return!(!c||!u||(r.push(function(t,e){const n=t,r=new Array(n).fill(!1);return{length:n,hitPositions:r,coordinates:e,hit:function(t){t>=0&&t<n&&(r[t]=!0)},isSunk:function(){return r.every((t=>!0===t))}}}(t,s)),0))}function s(t,e){let o=null;for(let i=0;i<r.length;i+=1)if(r[i].coordinates.filter((r=>n(r,{x:t,y:e}))).length){o=r[i];break}return o}return{add:i,fill:function(){for(;5!==r.length;){const n=e(9),r=e(9),o=0===e(1)?"horizontal":"vertical";i(t[0],n,r,o)&&t.shift()}},getCoords:s,receiveAttack:function(t,e){const i=s(t,e);if(i){const o=function(t,e){let r=-1;for(let o=0;o<e.length;o+=1)if(n(e[o],t)){r=o;break}return r}({x:t,y:e},i.coordinates);return i.hit(o),void(i.isSunk()&&function(t){const e=function(t){return r.indexOf(t)}(t);r.splice(e,1)}(i))}var c;c={x:t,y:e},o.push(c)},getMissedShots:function(){return o},hasShips:function(){return r.length>0},getShips:function(){return r},reset:function(){t=[5,4,3,3,2],r=[],o=[]}}},o=function(){const t=document.querySelector(".player"),e=document.querySelector(".computer"),n=document.querySelector(".results"),r=document.getElementById("winner"),o=document.getElementById("restart"),i=document.querySelector(".play");function s(t){const e=document.createElement("div");e.classList.add("gameboard");for(let n=0;n<=9;n+=1){const r=document.createElement("div");r.classList.add("column");for(let e=0;e<=9;e+=1){const o=document.createElement("div");o.classList.add("square"),o.setAttribute("data-coordinate",`${n},${e}`),t.getCoords(n,e)&&o.classList.add("ship"),r.appendChild(o)}e.appendChild(r)}return e}function c(t){const e=t.querySelector(".gameboard");e&&t.removeChild(e)}return{renderBoard:function(n,r){c(t),c(e);const o=s(n),i=s(r);t.appendChild(o),e.appendChild(i)},triggerPlayOnGameBoardClick:function(t){e.querySelectorAll(".square").forEach((e=>e.addEventListener("click",t,{once:!0})))},getPlayerBoardSquare:function(e,n){let r;const o=t.querySelectorAll(".square");for(let t=0;t<o.length;t+=1){const i=o[t].getAttribute("data-coordinate").split(","),s=parseInt(i[0],10),c=parseInt(i[1],10);if(e===s&&n===c){r=o[t];break}}return r},setSuccessfulHit:function(t){t.classList.add("ship-hit")},setMissedShot:function(t){t.classList.add("missed-shot")},popUpResults:function(t){n.classList.toggle("active"),function(t){r.textContent=`${t} won!`}(t)},triggerGameRestartOnResultsButtonClick:function(t){o.addEventListener("click",(e=>{t(e),n.classList.remove("active")}))},triggerBoardPlay:function(t){i.addEventListener("click",t)}}}(),i=o;(function(){const o=t(),s=r(),c=function(){const r=[];return{makePlay:function t(){const o={x:e(9),y:e(9)};var i;return i=o,r.some((t=>n(t,i)))?t():(function(t){r.push(t)}(o),o)},getPlays:function(){return r},...t()}}(),u=r();let a=!1;function l(t){t.fill()}function d(t){t.changeTurn()}function f(){o.changeTurn(),c.changeTurn()}function g(t){if(o.isTurn()&&!a){const e=t.target.getAttribute("data-coordinate").split(","),n=parseInt(e[0],10),r=parseInt(e[1],10),o=u.getCoords(n,r);u.receiveAttack(n,r),o?i.setSuccessfulHit(t.target):i.setMissedShot(t.target),u.hasShips()?(f(),function(){if(c.isTurn()&&!a){const t=c.makePlay(),{x:e,y:n}=t,r=s.getCoords(e,n);s.receiveAttack(e,n),r?i.setSuccessfulHit(i.getPlayerBoardSquare(e,n)):i.setMissedShot(i.getPlayerBoardSquare(e,n)),s.hasShips()?f():(i.popUpResults("Computer"),a=!0)}}()):(i.popUpResults("Player"),a=!0)}}function h(){s.reset(),u.reset(),o.resetTurn(),c.resetTurn(),a=!1,l(s),l(u),i.renderBoard(s,u),i.triggerPlayOnGameBoardClick(g),d(o)}return{start:function(){l(s),l(u),i.renderBoard(s,u),d(o),i.triggerPlayOnGameBoardClick(g),i.triggerGameRestartOnResultsButtonClick(h),i.triggerBoardPlay(h)}}})().start()})();